<script>
  lucide.createIcons();
  let allProviders = [];
  const grid = document.getElementById("providerGrid");

  function renderProviders(list) {
    grid.innerHTML = "";
    list.forEach(p => {
      const card = document.createElement("div");
      card.className = "bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden";
      card.innerHTML = `
        <img src="https://via.placeholder.com/300x200" alt="Provider"
             class="w-full h-40 object-cover">
        <div class="p-4">
          <h3 class="font-semibold text-gray-900">${p.name}</h3>
          <p class="text-sm text-gray-500">${p.services}</p>
          <div class="flex items-center text-sm mt-2">
            <i data-lucide="star" class="w-4 h-4 text-yellow-400 mr-1"></i>
            <span>${p.rating} (${p.reviews}+)</span>
          </div>
          <p class="text-sm text-teal-600 mt-1">$${p.priceMin} - $${p.priceMax}</p>
        </div>
      `;
      grid.appendChild(card);
    });
    lucide.createIcons();
  }

  async function fetchProviders() {
    try {
      const res = await fetch("http://127.0.0.1:8000/providers?service=beauty");
      allProviders = await res.json();
      renderProviders(allProviders);
    } catch (err) {
      console.error("Failed to fetch providers:", err);
    }
  }

  fetchProviders();

  document.getElementById("filterRating").addEventListener("click", () => {
    const sorted = [...allProviders].sort((a, b) => b.rating - a.rating);
    renderProviders(sorted);
  });

  document.getElementById("filterTime").addEventListener("click", () => {
    const sorted = [...allProviders].sort((a, b) => a.time - b.time);
    renderProviders(sorted);
  });

  document.getElementById("filterPrice").addEventListener("click", () => {
    const sorted = [...allProviders].sort((a, b) => a.priceMin - b.priceMin);
    renderProviders(sorted);
  });
</script>